{"componentChunkName":"component---src-templates-blog-post-js","path":"/custom-viewgroup-2-initialization-measure-and-layout/","result":{"data":{"site":{"siteMetadata":{"title":"Blog.kt"}},"markdownRemark":{"id":"3fc39f7e-e9fa-503e-94e1-3922871fc8ec","excerpt":"é¦–å…ˆè¯´ä¸€ä¸‹æ€è·¯ï¼Œè‡ªå®šä¹‰å¸ƒå±€å…¶å®ä¸éš¾ï¼Œæ ¸å¿ƒç‚¹å°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ measure å’Œ layoutã€‚è¿™ä¸ªå’Œæˆ‘ä»¬ç¼–å†™ XML å¸ƒå±€å‡ ä¹æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯æ¢äº†ä¸€ç§å®ç°æ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬ç”¨ Kotlin DSL å°è£…ä¸€ä¸‹ï¼Œå¯è¯»æ€§ä¼šå¤§å¤§æé«˜ã€‚ æˆ‘è‡ªå·±çš„å®ç°æµç¨‹ä¸€èˆ¬ä¸ºï¼š ç¡®å®šæ§ä»¶ä»¥åŠåˆå§‹åŒ– é‡å†™ measureâ€¦","html":"<p>é¦–å…ˆè¯´ä¸€ä¸‹æ€è·¯ï¼Œè‡ªå®šä¹‰å¸ƒå±€å…¶å®ä¸éš¾ï¼Œæ ¸å¿ƒç‚¹å°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ measure å’Œ layoutã€‚è¿™ä¸ªå’Œæˆ‘ä»¬ç¼–å†™ XML å¸ƒå±€å‡ ä¹æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯æ¢äº†ä¸€ç§å®ç°æ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬ç”¨ Kotlin DSL å°è£…ä¸€ä¸‹ï¼Œå¯è¯»æ€§ä¼šå¤§å¤§æé«˜ã€‚</p>\n<p>æˆ‘è‡ªå·±çš„å®ç°æµç¨‹ä¸€èˆ¬ä¸ºï¼š</p>\n<ol>\n<li>ç¡®å®šæ§ä»¶ä»¥åŠåˆå§‹åŒ–</li>\n<li>é‡å†™ measureï¼Œä¸ºå­æ§ä»¶æµ‹é‡å°ºå¯¸ï¼ŒåŒæ—¶è®¾ç½®å½“å‰ ViewGroup å°ºå¯¸</li>\n<li>é‡å†™ layout</li>\n<li>æ ¹æ®ä¸šåŠ¡å†…å®¹é‡å†™å…¶ä»–æ–¹æ³•æˆ–å®šåˆ¶æ¥å£ã€‚æ¯”å¦‚<a href=\"https://github.com/rosuH/EasyWatermark/blob/732fb957ca47a58148ff42d6dc4db7c61af58e0c/app/src/main/java/me/rosuh/easywatermark/widget/LaunchView.kt#L347-L378\">è§¦æ‘¸äº‹ä»¶å¤„ç†</a>ã€<a href=\"https://github.com/rosuH/EasyWatermark/blob/732fb957ca47a58148ff42d6dc4db7c61af58e0c/app/src/main/java/me/rosuh/easywatermark/widget/LaunchView.kt#L332-L345\">å¸ƒå±€è½¬æ¢</a>ç­‰</li>\n</ol>\n<h2>1. ç¡®å®šæ§ä»¶ä»¥åŠåˆå§‹åŒ–</h2>\n<p>è¿™ä¸€æ­¥è¯´çš„æ˜¯å¦‚ä½•è´´åˆä¸šåŠ¡ç¡®å®šå­æ§ä»¶åŠå…¶åˆå§‹åŒ–æ—¶æœºã€‚ä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ¥å£°æ˜ä¸€ä¸ªå­æ§ä»¶ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">val</span> ivPhoto<span class=\"token operator\">:</span> ImageView <span class=\"token keyword\">by</span> lazy <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">ImageView</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> android<span class=\"token punctuation\">.</span>R<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>Widget_ActionButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span> <span class=\"token punctuation\">{</span>\n        layoutParams <span class=\"token operator\">=</span>\n            <span class=\"token function\">MarginLayoutParams</span><span class=\"token punctuation\">(</span>\n                LayoutParams<span class=\"token punctuation\">.</span>WRAP_CONTENT<span class=\"token punctuation\">,</span>\n                LayoutParams<span class=\"token punctuation\">.</span>WRAP_CONTENT\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">also</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span><span class=\"token function\">setMargins</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">.</span>dp<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">setImageResource</span><span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">.</span>drawable<span class=\"token punctuation\">.</span>ic_picker_image<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol>\n<li>è¿™é‡Œä½¿ç”¨ lazy å§”æ‰˜è¿›è¡Œå»¶è¿Ÿåˆå§‹åŒ–ã€‚æ˜¯å¦å»¶è¿Ÿåˆå§‹åŒ–è§†ä¹æƒ…å†µè€Œå®šï¼Œå¦‚æœä½ çš„å­æ§ä»¶éå¸¸å¤šï¼Œå¹¶ä¸”ä¸æ˜¯å…¨éƒ½ä¼šåœ¨é¦–æ¬¡ç”¨åˆ°ï¼Œé‚£ä¹ˆå»ºè®®ä½¿ç”¨ <code class=\"language-text\">lazy</code> è¿›è¡Œå»¶è¿Ÿåˆå§‹åŒ–æ“ä½œã€‚ä½†æ˜¯å¦‚æœä½œä¸º RecyclerView çš„ itemï¼Œæˆ‘ä¸å»ºè®®ä½¿ç”¨ <code class=\"language-text\">lazy</code> æ“ä½œï¼Œè¿™æ ·åœ¨å¿«é€Ÿæ»‘åŠ¨çš„æƒ…å†µä¸‹å¯èƒ½ä¼šé™ä½æ€§èƒ½ã€‚\n<ul>\n<li>å› ä¸º <code class=\"language-text\">lazy</code> å†…éƒ¨ä½¿ç”¨ <code class=\"language-text\">synchronized</code> å…³é”®å­—å¯¹ <code class=\"language-text\">get</code> æ–¹æ³•è¿›è¡ŒåŒæ­¥ä¿æŠ¤ï¼Œæ‰€ä»¥åœ¨æ€§èƒ½æ•æ„Ÿåœºæ™¯ï¼Œä¸å¦‚ç›´æ¥åˆ›å»ºæ¥å¾—å¿«ã€‚</li>\n<li>å¦ä¸€æ–¹é¢ï¼ŒRecyclerView å­˜åœ¨<a href=\"https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:recyclerview/recyclerview/src/main/java/androidx/recyclerview/widget/RecyclerView.java;l=6756-6761?q=RecyclerView.java\">å›æ”¶æœºåˆ¶</a>ï¼Œåœ¨ä¸æ°å½“çš„æ—¶æœº <code class=\"language-text\">addView</code> å¯èƒ½å¯¼è‡´ä¸å¯é¢„æœŸçš„é—®é¢˜ã€‚ï¼ˆä»…çŒœæµ‹ï¼Œå¾…ç¡®è®¤ï¼‰</li>\n</ul>\n</li>\n<li><code class=\"language-text\">ImageView(context, null, 0, android.R.style.Widget_ActionButton)</code> è¿™ä¸ªæ„é€ å‡½æ•°å…è®¸æˆ‘ä»¬ä¼ å…¥è‡ªå®šä¹‰çš„ <code class=\"language-text\">Style</code>ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬å¤ç”¨æ§ä»¶çš„æ ·å¼ã€‚</li>\n<li>æ­¤å¤„æ²¡æœ‰åŠ å…¥ <code class=\"language-text\">addView()</code> çš„è°ƒç”¨ï¼Œè¡¨ç¤ºæˆ‘ä»¬å°†åœ¨ä½¿ç”¨åˆ°çš„æ—¶å€™æ‰‹åŠ¨è¿›è¡Œ <code class=\"language-text\">addView</code> ï¼Œè€Œä¸æ˜¯ç°åœ¨ã€‚</li>\n</ol>\n<p>å¦‚æœæˆ‘ä»¬çš„åœºæ™¯ä¸é€‚åˆï¼Œæˆ–è€…ä¸éœ€è¦å»¶è¿Ÿåˆå§‹åŒ–ï¼Œé‚£ä¹ˆä¸€ç§æ›´åŠ å¸¸è§çš„å£°æ˜æ–¹å¼å¦‚ä¸‹ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">val</span> ivPhoto<span class=\"token operator\">:</span> ImageView <span class=\"token operator\">=</span>\n    <span class=\"token function\">ImageView</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> android<span class=\"token punctuation\">.</span>R<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>Widget_ActionButton<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span> <span class=\"token punctuation\">{</span>\n        layoutParams <span class=\"token operator\">=</span>\n            <span class=\"token function\">MarginLayoutParams</span><span class=\"token punctuation\">(</span>\n                LayoutParams<span class=\"token punctuation\">.</span>WRAP_CONTENT<span class=\"token punctuation\">,</span>\n                LayoutParams<span class=\"token punctuation\">.</span>WRAP_CONTENT\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">also</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span><span class=\"token function\">setMargins</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">.</span>dp<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">setImageResource</span><span class=\"token punctuation\">(</span>R<span class=\"token punctuation\">.</span>drawable<span class=\"token punctuation\">.</span>ic_picker_image<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">addView</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>åœ¨ ViewGroup åˆ›å»ºæ—¶ï¼ŒåŒæ—¶åˆ›å»ºå­æ§ä»¶ï¼Œå¹¶ä¸”è°ƒç”¨ <code class=\"language-text\">addView()</code>ã€‚æ­¤æ—¶çš„ <code class=\"language-text\">addView</code> å¹¶ä¸ä¼šè§¦å‘ <code class=\"language-text\">requestLayout</code>ï¼Œå› ä¸º ViewGroup è¿˜æœª attach åˆ° window ä¸­ã€‚</p>\n<h2>2. é‡å†™ measure</h2>\n<p>æµ‹é‡éš¾å—ï¼Ÿå…¶å®å¤§éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯å¹¶ä¸éš¾ã€‚å¾ˆå¤šäººä¹Ÿçœ‹è¿‡è‡ªå®š View çš„ç›¸å…³æ–‡æ¡£å’Œæ–‡ç« ï¼Œå°¤å…¶å¯¹æµ‹é‡æ¨¡å¼ï¼ˆ<a href=\"https://developer.android.com/reference/android/view/View.MeasureSpec\">MeasureSpec</a>ï¼‰å°è±¡æ·±åˆ»ã€‚å…¶ä¸­çš„ <code class=\"language-text\">UNSPECIFIED</code>ã€<code class=\"language-text\">EXACTLY</code> å’Œ <code class=\"language-text\">AT_MOST</code> ä»¥åŠå„ç§æƒ…å†µæ’åˆ—ç»„åˆå½¢æˆäº†ä¸€å¼ å¤æ‚çš„ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>4</mn><mo>Ã—</mo><mn>4</mn></mrow><annotation encoding=\"application/x-tex\">4 \\times 4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">4</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">Ã—</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">4</span></span></span></span></span> è¡¨æ ¼ï¼Œè®©äººå¤´æ˜çœ¼èŠ± ğŸ˜µâ€ğŸ’« ã€‚</p>\n<p>ä½†å®é™…ä¸Šæˆ‘ä»¬åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œå¹¶ä¸éœ€è¦å»å¤„ç†ç›¸å…³é€»è¾‘ã€‚åœ¨æ­¤æ–‡ç« ä¸­ï¼Œæˆ‘ä¹Ÿè®©ä¸ä¼šå°†ä¸Šè¿°æµ‹é‡æ¨¡å¼å…¨éƒ½è®²æ¸…æ¥šï¼Œä½†æ˜¯æˆ‘ä»¬è‡³å°‘éœ€è¦çŸ¥é“å¦‚ä¸‹çŸ¥è¯†ï¼š</p>\n<ol>\n<li><code class=\"language-text\">onMeasure(widthMeasureSpec: Int, heightMeasureSpec: Int)</code> ä¸­çš„ <code class=\"language-text\">widthMeasureSpec</code> å’Œ <code class=\"language-text\">heightMeasureSpec</code> ä¿å­˜äº†æµ‹é‡æ¨¡å¼ <code class=\"language-text\">mode</code>ï¼ˆé«˜ä¸¤ä½ï¼‰å’Œ å°ºå¯¸ <code class=\"language-text\">size</code>ï¼ˆä½ 30 ä½ï¼‰ã€‚</li>\n<li><code class=\"language-text\">onMeasure</code> çš„ä¸¤ä¸ªå‚æ•°ï¼Œä»£è¡¨å½“å‰ View çš„çˆ¶å¸ƒå±€å¯¹å½“å‰ View çš„å°ºå¯¸è¦æ±‚ã€‚çˆ¶å¸ƒå±€å¹¶ä¸çŸ¥é“æˆ‘ä»¬æœ€ç»ˆçš„å°ºå¯¸ï¼Œä»–åªæ˜¯ç»™æˆ‘ä»¬ä¸€ä¸ªé¢„æœŸè¦æ±‚ï¼Œå¸Œæœ›æˆ‘ä»¬éµå®ˆã€‚å¦‚æœæˆ‘ä»¬ä¸éµå®ˆï¼Œé‚£ä»–å¯èƒ½å¼ºè¡Œä¿®æ”¹æˆ‘ä»¬çš„å°ºå¯¸ã€‚æ‰€ä»¥æˆ‘ä»¬å°½é‡éµå®ˆçˆ¶å¸ƒå±€çš„è¦æ±‚ï¼Œè¿™æ ·å¯¹å¤§å®¶éƒ½å¥½ :)</li>\n<li>View çš„å°ºå¯¸æ˜¯ç»“åˆçˆ¶å¸ƒå±€çš„è¦æ±‚æ¥ç¡®å®šçš„ã€‚ä»€ä¹ˆæ˜¯çˆ¶å¸ƒå±€çš„ã€Œè¦æ±‚ã€å‘¢ï¼Ÿçˆ¶å¸ƒå±€ä¼šæ ¹æ®å®ƒè‡ªå·±çš„çˆ¶å¸ƒå±€çš„è¦æ±‚ï¼Œä»¥åŠåœ¨ XML ä¸­å–åˆ°çš„è¦è¢«æµ‹é‡çš„å­ View çš„ <code class=\"language-text\">layout_width</code> å’Œ <code class=\"language-text\">layout_height</code> è¿™ä¸¤ä¸ªå±æ€§ï¼›æ ¹æ®å…¶å¸ƒå±€çš„ç‰¹æ€§ï¼ˆæ¯”å¦‚ LinearLayout å’Œ FrameLayout å°±æ˜¯ä¸åŒçš„ï¼‰è®¡ç®—å‡ºæœ€åçš„ MeasureSpecã€‚åé¢æˆ‘ä»¬ä¼šä¸¾ä¾‹å­è¯¦è¿°ã€‚</li>\n</ol>\n<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼Œéå¸¸ç®€å•ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">override fun <span class=\"token function\">onMeasure</span><span class=\"token punctuation\">(</span>widthMeasureSpec<span class=\"token operator\">:</span> <span class=\"token class-name\">Int</span><span class=\"token punctuation\">,</span> heightMeasureSpec<span class=\"token operator\">:</span> <span class=\"token class-name\">Int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">super</span><span class=\"token punctuation\">.</span><span class=\"token function\">onMeasure</span><span class=\"token punctuation\">(</span>widthMeasureSpec<span class=\"token punctuation\">,</span> heightMeasureSpec<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ä¸Šè¿°æ˜¯ ViewGroup çš„é»˜è®¤å®ç°ã€‚æœ€åå°†èµ°åˆ° View ä¸­çš„ <a href=\"https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/view/View.java;l=25539-25542?q=View.java\"><code class=\"language-text\">onMeasure</code></a> æ–¹æ³•:</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// View#onMeasure()</span>\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">onMeasure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> widthMeasureSpec<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> heightMeasureSpec<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setMeasuredDimension</span><span class=\"token punctuation\">(</span><span class=\"token function\">getDefaultSize</span><span class=\"token punctuation\">(</span><span class=\"token function\">getSuggestedMinimumWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> widthMeasureSpec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token function\">getDefaultSize</span><span class=\"token punctuation\">(</span><span class=\"token function\">getSuggestedMinimumHeight</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> heightMeasureSpec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// View#getSuggestedMinimumWidth()</span>\n<span class=\"token comment\">// è¿™é‡Œä¸»è¦è€ƒè™‘èƒŒæ™¯çš„å¤§å°æ˜¯å¦æœ‰æ‰€å½±å“</span>\n<span class=\"token keyword\">protected</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getSuggestedMinimumWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>mBackground <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> mMinWidth <span class=\"token operator\">:</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span>mMinWidth<span class=\"token punctuation\">,</span> mBackground<span class=\"token punctuation\">.</span><span class=\"token function\">getMinimumWidth</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// View#getDefaultSize()</span>\n<span class=\"token comment\">// é»˜è®¤çš„å°ºå¯¸å¤„ç†é€»è¾‘</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">int</span> <span class=\"token function\">getDefaultSize</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> size<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> measureSpec<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">int</span> result <span class=\"token operator\">=</span> size<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> specMode <span class=\"token operator\">=</span> <span class=\"token class-name\">MeasureSpec</span><span class=\"token punctuation\">.</span><span class=\"token function\">getMode</span><span class=\"token punctuation\">(</span>measureSpec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> specSize <span class=\"token operator\">=</span> <span class=\"token class-name\">MeasureSpec</span><span class=\"token punctuation\">.</span><span class=\"token function\">getSize</span><span class=\"token punctuation\">(</span>measureSpec<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>specMode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// çˆ¶å¸ƒå±€å¯¹å½“å‰ View æ²¡æœ‰è¦æ±‚ï¼Œå½“å‰ View ç›´æ¥æ˜¯å½“å‰çš„æµ‹é‡ç»“æœ</span>\n    <span class=\"token keyword\">case</span> <span class=\"token class-name\">Measure</span> <span class=\"token class-name\">Spec</span><span class=\"token punctuation\">.</span><span class=\"token constant\">UNSPECIFIED</span><span class=\"token operator\">:</span>\n        result <span class=\"token operator\">=</span> size<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token comment\">// çˆ¶å¸ƒå±€å¯¹å½“å‰ View æœ‰è¦æ±‚ï¼Œæœ€å¤§å€¼æˆ–è€…å…·ä½“å€¼ï¼Œç›´æ¥å–çˆ¶å¸ƒå±€çš„è¦æ±‚</span>\n\t<span class=\"token comment\">// æ‰€ä»¥ View å¯èƒ½ä¼šå˜å¾—æ¯”é¢„æœŸæ›´å¤§</span>\n    <span class=\"token keyword\">case</span> <span class=\"token class-name\">MeasureSpec</span><span class=\"token punctuation\">.</span><span class=\"token constant\">AT_MOST</span><span class=\"token operator\">:</span>\n    <span class=\"token keyword\">case</span> <span class=\"token class-name\">MeasureSpec</span><span class=\"token punctuation\">.</span><span class=\"token constant\">EXACTLY</span><span class=\"token operator\">:</span>\n        result <span class=\"token operator\">=</span> specSize<span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>è§£é‡Šä¸€ä¸‹ï¼š</p>\n<ol>\n<li>ViewGroup æ˜¯ View çš„å­ç±»ï¼Œæµ‹é‡æ–¹æ³•ä¹Ÿæ˜¯ç”¨çš„ View çš„æµ‹é‡æ–¹æ³•ï¼Œæ‰€ä»¥é»˜è®¤å®ç°ä¸ä¼šæ ¹æ®å­ View çš„æœ€ç»ˆå¤§å°æ¥å®ç°ã€‚</li>\n<li><code class=\"language-text\">setMeasuredDimension</code> ä¿å­˜å½“å‰ View çš„è®¡ç®—å°ºå¯¸ã€‚å¦‚æœæˆ‘ä»¬é‡å†™äº† <code class=\"language-text\">onMeasure</code>ï¼Œè‡ªå®šä¹‰å°ºå¯¸åï¼Œéœ€è¦è°ƒç”¨å®ƒæ¥ä¿å­˜ã€‚</li>\n</ol>\n<h3>2.1 æµ‹é‡æµç¨‹</h3>\n<p>æµ‹é‡æˆ‘ä»¬éœ€è¦è§£å†³ä¸‰ä¸ªé—®é¢˜ï¼š</p>\n<ol>\n<li>è¦æ€ä¹ˆæµ‹é‡ï¼Ÿ</li>\n<li>æµ‹é‡å“ªäº›ï¼Ÿ</li>\n<li>æµ‹é‡é¡ºåºï¼Ÿ</li>\n</ol>\n<h4>2.1.1 è¦æ€ä¹ˆå®ç°æµ‹é‡ï¼Ÿ</h4>\n<p>æ¥çœ‹ä¸€ä¸ªç®€å•çš„å¸ƒå±€ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[LinearLayout, w: 50]\n    [ViewGroup_1, w: wrap_content, orientation: horizontal]\n        &lt;TextView_1, w: 20>\n        &lt;TextView_2, w: 20>\n        &lt;TextView_3, w: 20>\n    [ViewGroup_1]\n[LinearLayout]</code></pre></div>\n<p>æˆ‘ä»¬å°†é‡å†™ <code class=\"language-text\">ViewGroup_1</code> çš„ <code class=\"language-text\">onMeasure</code> æ–¹æ³•ï¼Œå®ç°è‡ªå®šä¹‰æµ‹é‡è¿‡ç¨‹ã€‚æˆ‘ä»¬ä¸Šæ–‡è®²åˆ°è¿‡ï¼Œ<code class=\"language-text\">onMeasure(widthMeasureSpec, heightMeasureSpec)</code>çš„ä¸¤ä¸ªå‚æ•°ï¼Œæ˜¯çˆ¶å¸ƒå±€å¯¹æˆ‘ä»¬çš„è¦æ±‚ã€‚å¯¹äº <code class=\"language-text\">ViewGrou_1</code> æ¥è¯´ï¼ŒXML ä¸­æ ‡æ³¨æ˜¯ <code class=\"language-text\">wrap_content</code>ï¼Œä½†å› ä¸ºçˆ¶å¸ƒå±€ LinearLayout çš„å®½åº¦ä¸º <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>50</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">50dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">50</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span>ï¼Œæ‰€ä»¥æœ€ç»ˆ  <code class=\"language-text\">ViewGrou_1</code> çš„ <code class=\"language-text\">onMeasure</code> æ”¶åˆ°çš„æµ‹é‡æ¨¡å¼å°†æ˜¯ï¼š<code class=\"language-text\">mode = AT_MOST</code>, <code class=\"language-text\">size = 50.dp</code>ã€‚</p>\n<p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¤„ç†è‡ªèº«ä¸å­ View çš„å°ºå¯¸å…³ç³»ã€‚è¿™ä¸ªå…³ç³»è¯´éš¾ä¹Ÿä¸éš¾ï¼Œè¯´ç®€å•ä¹Ÿæœ‰ç‚¹éº»çƒ¦ã€‚Android å°è£…äº†ä¸€ä¸ªæ ·æ¿æ–¹æ³•ï¼Œä½ å¯ä»¥ç›´æ¥çœ‹<a href=\"https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/view/ViewGroup.java;l=6979?q=ViewGroup.getChildMeasureSpec&#x26;sq=\">æºç </a>ï¼Œæ¯”æˆ‘æ–‡å­—æè¿°æ›´åŠ ç›´ç™½ã€‚\nè¯¥æ–¹æ³•å…è®¸å­ View å°½é‡æ— é™åˆ¶åœ°å»æµ‹é‡å‡ºæœ€ä½³å¤§å°ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å®ç°æµ‹é‡çš„æ—¶å€™ï¼Œç›´æ¥è°ƒç”¨ <code class=\"language-text\">measureChildWithMargins</code> æ–¹æ³•å³å¯ã€‚</p>\n<ul>\n<li><code class=\"language-text\">measureChildWithMargins</code>æ˜¯ä»€ä¹ˆï¼Ÿ\n<ul>\n<li>å®ƒæ˜¯ Android ç»™æˆ‘ä»¬æä¾›çš„æ ·æ¿æ–¹æ³•ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿åœ°æµ‹é‡å­å¸ƒå±€</li>\n<li>åŸç†åœ¨ <a href=\"https://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/view/ViewGroup.java;l=6979?q=ViewGroup.getChildMeasureSpec&#x26;sq=\">View#getChildMeasureSpec</a>ï¼›æ³¨é‡Šè®²å¾—éå¸¸æ¸…æ¥šï¼Œæ­¤æ–¹æ³•ä¼šæ ¹æ®çˆ¶å¸ƒå±€è¦æ±‚çš„æµ‹é‡æ¨¡å¼å’Œå°ºå¯¸ï¼Œä»¥åŠè‡ªå·±çš„å®é™…å°ºå¯¸ï¼Œè®¡ç®—å‡º Specã€‚</li>\n<li>æ­¤æ–¹æ³•æ€»æ˜¯ä¼šç»™è¢«æµ‹é‡çš„å­ View æœ€ä½³çš„å°ºå¯¸ï¼Œä¹Ÿå°±æ˜¯æ— é™åˆ¶çš„æƒ…å†µä¸‹çš„æœ€ä½³å°ºå¯¸ã€‚å› ä¸ºå¤§éƒ¨åˆ†æ§ä»¶æˆ‘ä»¬éƒ½ä¸ä¼šå»åšé™åˆ¶ã€‚</li>\n<li>è®¡ç®—å‡ºæ¥ Spec åï¼Œæ­¤æ–¹æ³•å†…éƒ¨è°ƒç”¨ <code class=\"language-text\">child.measure(spec, spec)</code> è®©å­ View å»æµ‹é‡å¹¶ä¿å­˜å°ºå¯¸</li>\n</ul>\n</li>\n<li><code class=\"language-text\">heightUsed</code> å’Œ  <code class=\"language-text\">widthUsed</code> æ˜¯å•¥ï¼Ÿ\n<ul>\n<li>è¡¨ç¤ºå·²ç»è¢«ä½¿ç”¨äº†çš„å®½æˆ–é«˜ã€‚æ¯å½“æŸä¸ªæ§ä»¶å æ®äº†ä¸€éƒ¨åˆ†å®½é«˜ï¼Œå°±éœ€è¦åœ¨ä¸‹ä¸€ä¸ªæ§ä»¶æµ‹é‡æ—¶å‘Šè¯‰å®ƒå·²ç»è¢«ä½¿ç”¨çš„å®½é«˜ï¼Œä»¥ä¾¿æ­£ç¡®åˆ†é…å‰©ä½™ç©ºé—´</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// æ°´å¹³å¸ƒå±€\n[CustomViewGroup, w: 50, orientation: horizontal]\n    &lt;TextView_1, w: 20> --> available 50, widthUsed 20, actual 20\n    &lt;TextView_2, w: 20> --> available 30, widthUsed 40, actual 20\n    &lt;TextView_3, w: 20> --> available 10, widthUsed 50, actual 10\n[ViewGroup]</code></pre></div>\n<p>åœ¨æ„å»ºæ°´å¹³å¸ƒå±€æ—¶ï¼Œ<code class=\"language-text\">CustomViewGroup</code> å®½åº¦åªæœ‰ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>50</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">50dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">50</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span>ã€‚ä¸‰ä¸ª TextView ä¼˜å…ˆçº§ç›¸ç­‰ã€‚é‚£ä¹ˆï¼š</p>\n<ul>\n<li>TextView_1 ï¼š<code class=\"language-text\">CustomViewGroup</code> å·²ç»è¢«ä½¿ç”¨äº† <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>0</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">0dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">0</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span>ï¼Œæœ‰ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>50</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">50dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">50</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span> çš„å¯ç”¨ç©ºé—´ï¼Œæœ€ååªç”¨äº† <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>20</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">20dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">20</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span>\n<ul>\n<li><code class=\"language-text\">measureChildWithMargins(it, widthMeasureSpec, 0, heightMeasureSpec, heightUsed)</code></li>\n</ul>\n</li>\n<li>TextView_2 ï¼š<code class=\"language-text\">CustomViewGroup</code> å·²ç»è¢«ä½¿ç”¨äº† <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>20</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">20dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">20</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span>ï¼Œå¯ç”¨ç©ºé—´æœ‰ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>30</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">30dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">30</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span>ï¼Œä½†åªç”¨äº† <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>20</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">20dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">20</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span>\n<ul>\n<li><code class=\"language-text\">measureChildWithMargins(it, widthMeasureSpec, 20.dp, heightMeasureSpec, heightUsed)</code></li>\n</ul>\n</li>\n<li>TextView_3ï¼š<code class=\"language-text\">CustomViewGroup</code> å·²ç»è¢«ä½¿ç”¨äº† <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>40</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">40dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">40</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span>ï¼›æœŸæœ› <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>20</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">20dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">20</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span>ï¼Œä½†åªæœ‰ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>10</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">10dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">10</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span> å¯ç”¨ï¼Œæ‰€ä»¥åªèƒ½ç”¨ <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>10</mn><mi>d</mi><mi>p</mi></mrow><annotation encoding=\"application/x-tex\">10dp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">10</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">p</span></span></span></span></span>\n<ul>\n<li><code class=\"language-text\">measureChildWithMargins(it, widthMeasureSpec, 40.dp, heightMeasureSpec, heightUsed)</code></li>\n</ul>\n</li>\n</ul>\n<p>ä¸€å¥è¯æ€»ç»“ï¼š<strong><code class=\"language-text\">widthUsed</code> å’Œ <code class=\"language-text\">heightUsed</code> å°±æ˜¯å·²ç»è¢«ä½¿ç”¨çš„ç©ºé—´ã€‚å¦‚æœå‰©ä¸‹çš„æ§ä»¶æ˜¯æŒ‰å‰©ä½™ç©ºé—´åˆ†é…çš„ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¼ é€’è¿™ä¸¤ä¸ªå€¼ä»¥ä¾¿è®¡ç®—ï¼›å¦‚æœä¸æ˜¯æŒ‰å‰©ä½™ç©ºé—´åˆ†é…ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå€¼å°±æ˜¯ 0</strong>ã€‚</p>\n<p>è®²å®Œ <code class=\"language-text\">measureChildWithMargins</code> å…¶å®å°±å·²ç»å·®ä¸å¤šäº†ã€‚æµ‹é‡çš„æ ¸å¿ƒå°±åœ¨è¿™é‡Œã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¸éœ€è¦è‡ªå·±åˆ¤æ–­æµ‹é‡æ¨¡å¼ã€‚å¦‚æœçœŸåˆ°äº†éœ€è¦è‡ªå·±åˆ¤æ–­æµ‹é‡æ¨¡å¼çš„æ—¶å€™ï¼Œå†å»ä»”ç»†ç ”ç©¶ä¹Ÿä¸è¿Ÿã€‚</p>\n<h4>2.1.2 éœ€è¦æµ‹é‡å“ªäº›ï¼Ÿ</h4>\n<p>View çš„æ˜¾éšæ€§ä¸ä¼šå½±å“å…¶å®½é«˜ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥æµ‹é‡ <code class=\"language-text\">View.GONE</code> çš„æ§ä»¶å¹¶è·å¾—æ­£ç¡®å°ºå¯¸ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯è‡ªå·±åˆ¤æ–­å“ªäº›ä¸éœ€è¦è¢«æµ‹é‡ã€‚</p>\n<ul>\n<li>ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬éœ€è¦å¿½ç•¥ <code class=\"language-text\">View.GONE</code> çš„æ§ä»¶ï¼Œè¿™æ ·æ‰ç¬¦åˆå¤§å¤šæ•°å¼€å‘è€…çš„ä¹ æƒ¯ã€‚</li>\n<li>æ ¹æ®ä¸šåŠ¡éœ€æ±‚ï¼Œå»¶è¿Ÿæµ‹é‡ä¸éœ€è¦æ˜¾ç¤ºçš„æ§ä»¶ã€‚è¿™ä¸ªæ˜¯å¯é€‰çš„ï¼Œå¦‚æœåœ¨æ­¤æ—¶å»¶è¿Ÿæµ‹é‡ï¼Œé‚£ä¹ˆåç»­è§†æƒ…å†µå¯èƒ½éœ€è¦é‡æ–°å¸ƒå±€ï¼Œè¦çœ‹å…·ä½“åœºæ™¯å’Œå–èˆã€‚</li>\n</ul>\n<h4>2.1.3 æµ‹é‡é¡ºåº</h4>\n<p>åœ¨ Android å¸ƒå±€ä¸­ï¼Œæ€»æ˜¯éœ€è¦çº¦æŸæ¥å†³å®šæ§ä»¶çš„ä¼˜å…ˆçº§ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[CustomViewGroup, orientaion: vertical]\n  &lt;TextView_1, visibility: View.GONE>\n  &lt;TextView_2, constraint: optional>\n  &lt;TextView_3, constraint: force>\n[CustomViewGroup]</code></pre></div>\n<p>æ­¤å¤„ç”¨ <code class=\"language-text\">constraint</code> è¡¨ç¤ºæ˜¾ç¤ºçº¦æŸã€‚</p>\n<ul>\n<li><code class=\"language-text\">TextView_1</code> æ˜¯éšè—çš„ï¼Œæˆ‘ä»¬ä¸æµ‹é‡</li>\n<li><code class=\"language-text\">TextView_2</code> æ˜¯å¯é€‰çš„ï¼Œå½“åˆ†é…å®Œ <code class=\"language-text\">TextView_3</code> åçš„å‰©ä½™ç©ºé—´å°±ç»™å®ƒï¼Œå¦åˆ™å°±ä¸æ˜¾ç¤º</li>\n<li><code class=\"language-text\">TextView_3</code> æ˜¯å¼ºåˆ¶çš„ï¼Œä¼˜å…ˆçº§æœ€é«˜ã€‚ä¼˜å…ˆä¿è¯å®ƒæ˜¾ç¤ºå®Œå…¨ï¼Œå¦‚æœè¿˜æœ‰å‰©ä½™ç©ºé—´ï¼Œå†è®©å…¶ä»–æ§ä»¶åˆ†é…</li>\n</ul>\n<p>æˆ‘ä»¬å°†è¦å®ç°å¦‚å›¾æ‰€ç¤ºçš„æµ‹é‡æ–¹å¼ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onMeasure</span><span class=\"token punctuation\">(</span>widthMeasureSpec<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">,</span> heightMeasureSpec<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> heightUsed <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">var</span> widthUsed <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\t<span class=\"token comment\">// éå†æ‰€æœ‰å­æ§ä»¶</span>\n    children\n        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// è¿‡æ»¤ç•™ä¸‹ä¼˜å…ˆçº§æœ€é«˜çš„ï¼Œä¸”é View.GONE çš„æ§ä»¶</span>\n            it<span class=\"token punctuation\">.</span>visibility <span class=\"token operator\">!=</span> View<span class=\"token punctuation\">.</span>GONE <span class=\"token operator\">&amp;&amp;</span> it<span class=\"token punctuation\">.</span>constraint <span class=\"token operator\">==</span> Force\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// æŒ‰ç…§æ— é™åˆ¶å°ºå¯¸å»æµ‹é‡</span>\n            <span class=\"token function\">measureChildWithMargins</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">,</span> widthMeasureSpec<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> heightMeasureSpec<span class=\"token punctuation\">,</span> heightUsed<span class=\"token punctuation\">)</span>\n            <span class=\"token comment\">// å‚ç›´å¸ƒå±€ï¼Œæ‰€ä»¥é«˜åº¦å åŠ ï¼Œ</span>\n            heightUsed <span class=\"token operator\">+=</span> it<span class=\"token punctuation\">.</span>measuredHeight\n            <span class=\"token comment\">// å‚ç›´å¸ƒå±€ï¼Œå®½åº¦ä»¥æœ€å¤§å­æ§ä»¶å®½åº¦ä¸ºå‡†</span>\n            widthUsed <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>widthUsed<span class=\"token punctuation\">,</span> it<span class=\"token punctuation\">.</span>measuredWidth<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\t<span class=\"token comment\">// å†æµ‹é‡ä¼˜å…ˆçº§è¾ƒä½çš„ optional åˆ—è¡¨</span>\n\t<span class=\"token function\">getOptionsList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// ä¼ é€’ widthUsedï¼Œå­æ§ä»¶è‡ªå·±æ ¹æ®å‰©ä½™ç©ºé—´æ¥è®¡ç®—å°ºå¯¸</span>\n            <span class=\"token comment\">// è€Œä¸å†æ˜¯æ— é™åˆ¶æµ‹é‡</span>\n            <span class=\"token function\">measureChildWithMargins</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">,</span> widthMeasureSpec<span class=\"token punctuation\">,</span> widthUsed<span class=\"token punctuation\">,</span> heightMeasureSpec<span class=\"token punctuation\">,</span> heightUsed<span class=\"token punctuation\">)</span>\t\n            <span class=\"token comment\">// å‚ç›´å¸ƒå±€ï¼Œæ‰€ä»¥é«˜åº¦å åŠ ï¼Œ</span>\n            heightUsed <span class=\"token operator\">+=</span> it<span class=\"token punctuation\">.</span>measuredHeight\n            <span class=\"token comment\">// å‚ç›´å¸ƒå±€ï¼Œå®½åº¦ä»¥æœ€å¤§å­æ§ä»¶å®½åº¦ä¸ºå‡†</span>\n            widthUsed <span class=\"token operator\">=</span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">max</span><span class=\"token punctuation\">(</span>widthUsed<span class=\"token punctuation\">,</span> it<span class=\"token punctuation\">.</span>measuredWidth<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token comment\">// ä¿å­˜å½“å‰ ViewGroup çš„å°ºå¯¸</span>\n\t<span class=\"token function\">setMeasuredDimension</span><span class=\"token punctuation\">(</span>widthUsed<span class=\"token punctuation\">,</span> heightUsed<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>measure çš„ç†è®ºçŸ¥è¯†éƒ¨åˆ†åˆ°è¿™é‡Œå°±å·®ä¸å¤šäº†ã€‚æ›´å¤šçš„éœ€è¦è‡ªå·±åŠ¨æ‰‹å»å°è¯•ï¼Œå»çœŸæ­£çš„å®ç°ï¼Œæ‰èƒ½æœ‰æ›´æ·±çš„ä½“ä¼šã€‚åç»­ä¼šæœ‰æ–‡ç« ä»‹ç»éƒ¨åˆ†å®è·µå†…å®¹ï¼Œæ•¬è¯·æœŸå¾…ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ layout éƒ¨åˆ†ã€‚</p>\n<p><strong>æœ€åï¼Œå¦‚æœä½ é‡åˆ°</strong>â€¦</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">java.lang.ClassCastException: android.view.ViewGroup$LayoutParams cannot be cast to android.view.ViewGroup$MarginLayoutParams</code></pre></div>\n<p>ä¸ç”¨æ‹…å¿ƒï¼Œè¿™ä¸ªæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨å‰é¢éƒ½æ²¡æœ‰è®¨è®º margin æµ‹é‡é—®é¢˜ã€‚å…¶å®è¿™ä¸ªä¹Ÿå¾ˆç®€å•ã€‚\nå¦‚æœä½ çš„å­ View éƒ½æ˜¯è‡ªå·±æ„å»ºçš„ï¼Œé‚£ä¹ˆç»™å­ View è®¾ç½® <code class=\"language-text\">layoutParams</code> ä¸º <code class=\"language-text\">MarginLayoutParams</code> å³å¯ã€‚æˆ–è€…é‡å†™ <code class=\"language-text\">generateDefaultLayoutParams</code> æ–¹æ³•ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">generateDefaultLayoutParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> LayoutParams <span class=\"token punctuation\">{</span>  \n    <span class=\"token keyword\">return</span> <span class=\"token function\">MarginLayoutParams</span><span class=\"token punctuation\">(</span>LayoutParams<span class=\"token punctuation\">.</span>WRAP_CONTENT<span class=\"token punctuation\">,</span> LayoutParams<span class=\"token punctuation\">.</span>WRAP_CONTENT<span class=\"token punctuation\">)</span>  \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>å¦‚æœä½ ä»æœ‰å­ View æ˜¯æ¥è‡ª XML çš„ï¼Œå½“è¯¥ View æ²¡æœ‰è®¾ç½® <code class=\"language-text\">layour_margin</code> ç›¸å…³å±æ€§æ—¶ï¼Œç³»ç»Ÿé»˜è®¤ä¸º <code class=\"language-text\">ViewGroup.LayoutParams</code>ã€‚é‚£ä¹ˆæˆ‘ä»¬ç›´æ¥åœ¨ <code class=\"language-text\">onMeasure</code> æ—¶åˆ¤æ–­å³å¯ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\"><span class=\"token keyword\">override</span> <span class=\"token keyword\">fun</span> <span class=\"token function\">onMeasure</span><span class=\"token punctuation\">(</span>widthMeasureSpec<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">,</span> heightMeasureSpec<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> heightUsed <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    <span class=\"token keyword\">var</span> widthUsed <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    children\n        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span>visibility <span class=\"token operator\">!=</span> View<span class=\"token punctuation\">.</span>GONE <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">forEachIndexed</span> <span class=\"token punctuation\">{</span> index<span class=\"token punctuation\">,</span> view <span class=\"token operator\">-></span>\n\t\t\t<span class=\"token comment\">// åˆ¤æ–­ LayoutParams ç±»å‹</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>view<span class=\"token punctuation\">.</span>layoutParams <span class=\"token keyword\">is</span> MarginLayoutParams<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">measureChildWithMargins</span><span class=\"token punctuation\">(</span>\n                    view<span class=\"token punctuation\">,</span>\n                    widthMeasureSpec<span class=\"token punctuation\">,</span>\n                    widthUsed<span class=\"token punctuation\">,</span>\n                    heightMeasureSpec<span class=\"token punctuation\">,</span>\n                    heightUsed\n                <span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">measureChild</span><span class=\"token punctuation\">(</span>view<span class=\"token punctuation\">,</span> widthMeasureSpec<span class=\"token punctuation\">,</span> heightMeasureSpec<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n            widthUsed <span class=\"token operator\">=</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span>widthUsed<span class=\"token punctuation\">,</span> view<span class=\"token punctuation\">.</span>measuredWidth<span class=\"token punctuation\">)</span>\n            heightUsed <span class=\"token operator\">+=</span> view<span class=\"token punctuation\">.</span>measuredHeight <span class=\"token operator\">+</span> view<span class=\"token punctuation\">.</span>marginTop <span class=\"token operator\">+</span> view<span class=\"token punctuation\">.</span>marginBottom\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token function\">setMeasuredDimension</span><span class=\"token punctuation\">(</span>widthUsed<span class=\"token punctuation\">,</span> heightUsed<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>3. é‡å†™ layout</h2>\n<p>layout æ¯” measure æ›´åŠ ç®€å•ã€‚ä¸éœ€è¦åšå¤ªå¤šçš„æ¯”è¾ƒå’Œåˆ¤æ–­ã€‚æˆ‘ä»¬åœ¨é‡å†™ <code class=\"language-text\">onLayout</code> çš„è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬å…³æ³¨ï¼š</p>\n<ol>\n<li>æ§ä»¶çš„æ’åˆ—é¡ºåºä¸äº’ç›¸ä½ç½®çº¦æŸ</li>\n<li><code class=\"language-text\">margin</code> å’Œ <code class=\"language-text\">padding</code> çš„å¤„ç†ï¼š<code class=\"language-text\">View.measureWidth</code> å’Œ <code class=\"language-text\">View.measureHeight</code> æ˜¯ä¸å« <code class=\"language-text\">margin</code> çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦è§†æƒ…å†µæ¥åŠ ä¸Šæˆ–å‡å» <code class=\"language-text\">margin</code> å€¼ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¤„ç† ViewGroup çš„ <code class=\"language-text\">padding</code> å¯¹å­ View çš„å½±å“ã€‚å¦‚æœä½ çš„ <code class=\"language-text\">ViewGroup</code> å­˜åœ¨ <code class=\"language-text\">padding</code>ï¼Œé‚£ä¹ˆè®°å¾—åšå¥½å¤„ç†å“¦ã€‚</li>\n</ol>\n<p>å¯¹äº child çš„å¸ƒå±€ï¼Œç›´æ¥è°ƒç”¨ <code class=\"language-text\">child.layout(0, 0, 0, 0)</code> å³å¯å®Œæˆã€‚åœ¨æ­¤éƒ¨åˆ†æ›´å…³æ³¨ä¸šåŠ¡ä¸Šçš„ UI å®ç°ã€‚æ¯”å¦‚ä¸€ä¸ªç®€å•çš„å‚ç›´çš„å¸ƒå±€ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š</p>\n<div class=\"gatsby-highlight\" data-language=\"kotlin\"><pre class=\"language-kotlin\"><code class=\"language-kotlin\">ooverride <span class=\"token keyword\">fun</span> <span class=\"token function\">onLayout</span><span class=\"token punctuation\">(</span>changed<span class=\"token operator\">:</span> Boolean<span class=\"token punctuation\">,</span> l<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">,</span> t<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">,</span> r<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">,</span> b<span class=\"token operator\">:</span> Int<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">var</span> heightUsed <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n    children\n        <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span> <span class=\"token punctuation\">{</span> it<span class=\"token punctuation\">.</span>visibility <span class=\"token operator\">!=</span> View<span class=\"token punctuation\">.</span>GONE <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">forEachIndexed</span> <span class=\"token punctuation\">{</span> index<span class=\"token punctuation\">,</span> it <span class=\"token operator\">-></span>\n            it<span class=\"token punctuation\">.</span><span class=\"token function\">layout</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> heightUsed<span class=\"token punctuation\">,</span> it<span class=\"token punctuation\">.</span>measuredWidth<span class=\"token punctuation\">,</span> it<span class=\"token punctuation\">.</span>measuredHeight <span class=\"token operator\">+</span> heightUsed<span class=\"token punctuation\">)</span>\n            heightUsed <span class=\"token operator\">=</span> it<span class=\"token punctuation\">.</span>bottom\n        <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>æ˜¯ä¸æ˜¯éå¸¸ç®€å•ğŸ¤“ ï½ å½“ç„¶ï¼Œè¿™é‡Œéœ€è¦ä½ å¯¹ <code class=\"language-text\">View</code> çš„ä½ç½®å…³ç³»æœ‰æ‰€äº†è§£ã€‚æ¯”å¦‚æˆ‘å¸¸ç”¨ <code class=\"language-text\">View.bottom</code> è¿™ç±»å±æ€§æ¥ä½œä¸ºä¸Šä¸‹å·¦å³çº¦æŸã€‚å°±åƒä¸Šè¿°ä»£ç ä¸€æ ·ã€‚</p>\n<p>ä¸è¿‡æœ‰äº›åœºæ™¯ï¼Œè¿™æ˜¯ä¸å¤Ÿçš„ï¼š</p>\n<ul>\n<li>å¯¹äºæˆ‘ä»¬å‰é¢æåˆ°çš„ Chip ä¹‹ç±»çš„æ ‡ç­¾å¸ƒå±€ï¼Œè¿˜éœ€è¦è€ƒè™‘æ¢è¡Œã€‚è¿™ç§æ—¶å€™å°±éœ€è¦æ ¹æ®è¡Œçš„å‰©ä½™å®½åº¦ï¼Œä¸å³å°† layout çš„å­ View æ¯”è¾ƒï¼Œå¦‚æœæ”¾ä¸ä¸‹ï¼Œé‚£ä¹ˆå°±è¦ç§»åˆ°ä¸‹ä¸€è¡Œå»å¤„ç†ã€‚</li>\n<li>å¯¹äºçº¦æŸåœ¨å³è¾¹çš„æ§ä»¶ï¼Œæ¯”å¦‚å¯¹å…¶å³è¾¹ç•Œæ­¤ç§ï¼Œéœ€è¦åšä¸€ä¸‹å‡æ³•è®¡ç®—ã€‚</li>\n</ul>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>x</mi><mo>=</mo><mi>C</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>o</mi><mi>m</mi><mi>V</mi><mi>i</mi><mi>e</mi><mi>w</mi><mi>G</mi><mi>r</mi><mi>o</mi><mi>u</mi><mi>p</mi><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>e</mi><mi>a</mi><mi>s</mi><mi>u</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>W</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi><mo>âˆ’</mo><mi>C</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>o</mi><mi>m</mi><mi>V</mi><mi>i</mi><mi>e</mi><mi>w</mi><mi>G</mi><mi>r</mi><mi>o</mi><mi>u</mi><mi>p</mi><mi mathvariant=\"normal\">.</mi><mi>p</mi><mi>a</mi><mi>d</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>E</mi><mi>n</mi><mi>d</mi><mo>âˆ’</mo><mo stretchy=\"false\">(</mo><mi>i</mi><mi>t</mi><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>e</mi><mi>a</mi><mi>s</mi><mi>u</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>W</mi><mi>i</mi><mi>d</mi><mi>t</mi><mi>h</mi><mo>+</mo><mi>i</mi><mi>t</mi><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>i</mi><mi>n</mi><mi>S</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi><mo>+</mo><mi>i</mi><mi>t</mi><mi mathvariant=\"normal\">.</mi><mi>m</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>i</mi><mi>n</mi><mi>E</mi><mi>n</mi><mi>d</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">x = CustomViewGroup.measuredWidth - CustomViewGroup.paddingEnd - (it.measuredWidth + it.marginStart + it.marginEnd)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">mVi</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">wG</span><span class=\"mord mathnormal\">ro</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">p</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">re</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">Wi</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.07153em;\">C</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">mVi</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">wG</span><span class=\"mord mathnormal\">ro</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">p</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">dd</span><span class=\"mord mathnormal\">in</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">re</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">Wi</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">h</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">ma</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">in</span><span class=\"mord mathnormal\">St</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mord\">.</span><span class=\"mord mathnormal\">ma</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">in</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mclose\">)</span></span></span></span></span></div>\n<p>ä½ å¯ä»¥æŠ½è±¡æˆä¸€ä¸ªå‡½æ•°ï¼Œä¸è¿‡å¯èƒ½ä¸ä¾¿äºå…¶ä»–ç»´æŠ¤è€…ç†è§£ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p>\n<p>å½“ç„¶ï¼Œè¿˜æœ‰æ›´å¤æ‚çš„å¸ƒå±€ã€‚æ¯”å¦‚ç¯ç»•ã€åœ†å½¢ã€ç€‘å¸ƒæµç­‰ç­‰å¼‚å‹å¸ƒå±€ï¼Œå°±éœ€è¦æˆ‘ä»¬æ ¹æ®å®é™…æƒ…å†µå»å®ç°å•¦ã€‚ä½†æ˜¯åŸç†éƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p>\n<h2>4. æ€»ç»“</h2>\n<p>æˆ‘ä»¬ä»å­æ§ä»¶åˆå§‹åŒ–å¼€å§‹ï¼Œè®²åˆ°å¦‚ä½•åˆ©ç”¨ <code class=\"language-text\">measureChild</code> å®ç°æµ‹é‡ï¼Œä»¥åŠå¦‚ä½•å¸ƒå±€ã€‚å‡ ä¹æŠŠï¼ˆæˆ‘é‡åˆ°çš„ï¼‰å¸¸è§çš„ä¸šåŠ¡ UI éƒ½åŒ…å«åœ¨å†…ã€‚å¦‚æœä½ èƒ½çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ç›¸ä¿¡å³ä¾¿ä½ è¿˜æ²¡æœ‰å®Œå…¨æŒæ¡æ¸²æŸ“æµç¨‹ï¼Œä½†ä¹Ÿèƒ½äº†è§£äº†å…­ä¸ƒåˆ†äº†ğŸ˜‹ ã€‚ä¸è¿‡ä»…æœ‰ç†è®ºæ€»å½’æ˜¯ä¸å¤Ÿçš„ï¼Œåç»­æˆ‘å°†ä¼šåˆ†äº«å®è·µç›¸å…³çš„æ–‡ç« ï¼Œç”¨ä¸€äº›ç®€å•æ–¹ä¾¿å…¥æ‰‹çš„ä¾‹å­ï¼Œå¸®åŠ©ä½ å¿«é€ŸæŒæ¡è‡ªå®šä¹‰ ViewGroup çš„æ¸²æŸ“æµç¨‹ã€‚æœŸå¾…ä¸ä½ å†è§ï½</p>","frontmatter":{"title":"è‡ªå®šä¹‰å¸ƒå±€å…¶äºŒï¼šåˆå§‹åŒ–ã€æµ‹é‡å’Œå¸ƒå±€","date":"2021-08-24","description":null,"excerpt":"é¦–å…ˆè¯´ä¸€ä¸‹æ€è·¯ï¼Œè‡ªå®šä¹‰å¸ƒå±€å…¶å®ä¸éš¾ï¼Œæ ¸å¿ƒç‚¹å°±æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ measure å’Œ layoutã€‚è¿™ä¸ªå’Œæˆ‘ä»¬ç¼–å†™ XML å¸ƒå±€å‡ ä¹æ˜¯ä¸€è‡´çš„ï¼Œåªæ˜¯æ¢äº†ä¸€ç§å®ç°æ–¹å¼ã€‚å¦‚æœæˆ‘ä»¬ç”¨ Kotlin DSL å°è£…ä¸€ä¸‹ï¼Œå¯è¯»æ€§ä¼šå¤§å¤§æé«˜ã€‚"}},"previous":{"fields":{"slug":"custom-viewgroup-1-cons-and-pros"},"frontmatter":{"title":"è‡ªå®šä¹‰å¸ƒå±€å…¶ä¸€ï¼šä¼˜åŠ£åŠ¿ä¸ä½¿ç”¨åœºæ™¯"}},"next":{"fields":{"slug":"2021_summary"},"frontmatter":{"title":"è®¤çŸ¥ä¸æ¥çº³ï¼š2021å¹´ç»ˆæ€»ç»“"}}},"pageContext":{"id":"3fc39f7e-e9fa-503e-94e1-3922871fc8ec","previousPostId":"618511a2-87a9-5d86-bd57-43667df94782","nextPostId":"23b39275-a1f5-5c72-b7e9-993c736b4439"}},"staticQueryHashes":["2082311839","2355076697","959449634"],"slicesMap":{}}